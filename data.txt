00008000  01 43 44 30 30 31 01 00  4c 49 4e 55 58 20 20 20  |.CD001..LINUX   |
00008010  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00008020  20 20 20 20 20 20 20 20  43 44 52 4f 4d 20 20 20  |        CDROM   |
00008030  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00008040  20 20 20 20 20 20 20 20  00 00 00 00 00 00 00 00  |        ........|
00008050  b7 00 00 00 00 00 00 b7  00 00 00 00 00 00 00 00  |................|
00008060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00008070  00 00 00 00 00 00 00 00  01 00 00 01 01 00 00 01  |................|
00008080  00 08 08 00 24 00 00 00  00 00 00 24 14 00 00 00  |....$......$....|
00008090  00 00 00 00 00 00 00 16  00 00 00 00 22 00 18 00  |............"...|
000080a0  00 00 00 00 00 18 00 08  00 00 00 00 08 00 7a 09  |..............z.|
000080b0  08 04 2c 13 0c 02 00 00  01 00 00 01 01 00 20 20  |..,...........  |
000080c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008230  20 20 20 20 20 20 20 20  20 20 20 20 20 20 47 45  |              GE|
00008240  4e 49 53 4f 49 4d 41 47  45 20 49 53 4f 20 39 36  |NISOIMAGE ISO 96|
00008250  36 30 2f 48 46 53 20 46  49 4c 45 53 59 53 54 45  |60/HFS FILESYSTE|
00008260  4d 20 43 52 45 41 54 4f  52 20 28 43 29 20 31 39  |M CREATOR (C) 19|
00008270  39 33 20 45 2e 59 4f 55  4e 47 44 41 4c 45 20 28  |93 E.YOUNGDALE (|
00008280  43 29 20 31 39 39 37 2d  32 30 30 36 20 4a 2e 50  |C) 1997-2006 J.P|
00008290  45 41 52 53 4f 4e 2f 4a  2e 53 43 48 49 4c 4c 49  |EARSON/J.SCHILLI|
000082a0  4e 47 20 28 43 29 20 32  30 30 36 2d 32 30 30 37  |NG (C) 2006-2007|
000082b0  20 43 44 52 4b 49 54 20  54 45 41 4d 20 20 20 20  | CDRKIT TEAM    |
000082c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008320  20 20 20 20 20 20 20 20  20 20 20 20 20 32 30 32  |             202|
00008330  32 30 39 30 38 31 30 32  37 31 31 30 30 0c 32 30  |2090810271100.20|
00008340  32 32 30 39 30 38 31 30  32 37 31 31 30 30 0c 30  |22090810271100.0|
00008350  30 30 30 30 30 30 30 30  30 30 30 30 30 30 30 00  |000000000000000.|
00008360  32 30 32 32 30 39 30 38  31 30 32 37 31 31 30 30  |2022090810271100|
00008370  0c 01 00 20 20 20 20 20  20 20 20 20 20 20 20 20  |...             |
00008380  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008570  20 20 20 00 00 00 00 00  00 00 00 00 00 00 00 00  |   .............|
00008580  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008800  00 43 44 30 30 31 01 45  4c 20 54 4f 52 49 54 4f  |.CD001.EL TORITO|
00008810  20 53 50 45 43 49 46 49  43 41 54 49 4f 4e 00 00  | SPECIFICATION..|
00008820  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008840  00 00 00 00 00 00 00 1b  00 00 00 00 00 00 00 00  |................|
00008850  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00009000  ff 43 44 30 30 31 01 00  00 00 00 00 00 00 00 00  |.CD001..........|
00009010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000a000  01 00 18 00 00 00 01 00  00 00 04 00 19 00 00 00  |................|
0000a010  01 00 42 4f 4f 54 06 00  1a 00 00 00 01 00 4b 45  |..BOOT........KE|
0000a020  52 4e 45 4c 00 00 00 00  00 00 00 00 00 00 00 00  |RNEL............|
0000a030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000b000  01 00 00 00 00 18 00 01  00 00 04 00 00 00 00 19  |................|
0000b010  00 01 42 4f 4f 54 06 00  00 00 00 1a 00 01 4b 45  |..BOOT........KE|
0000b020  52 4e 45 4c 00 00 00 00  00 00 00 00 00 00 00 00  |RNEL............|
0000b030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000c000  22 00 18 00 00 00 00 00  00 18 00 08 00 00 00 00  |"...............|
0000c010  08 00 7a 09 08 04 2c 13  0c 02 00 00 01 00 00 01  |..z...,.........|
0000c020  01 00 22 00 18 00 00 00  00 00 00 18 00 08 00 00  |..".............|
0000c030  00 00 08 00 7a 09 08 0a  1b 0b 0c 02 00 00 01 00  |....z...........|
0000c040  00 01 01 01 26 00 19 00  00 00 00 00 00 19 00 08  |....&...........|
0000c050  00 00 00 00 08 00 7a 09  08 0a 1a 1e 0c 02 00 00  |......z.........|
0000c060  01 00 00 01 04 42 4f 4f  54 00 2c 00 1b 00 00 00  |.....BOOT.,.....|
0000c070  00 00 00 1b 00 08 00 00  00 00 08 00 7a 09 08 0a  |............z...|
0000c080  1b 0b 0c 00 00 00 01 00  00 01 0a 42 4f 4f 54 2e  |...........BOOT.|
0000c090  43 41 54 3b 31 00 28 00  1a 00 00 00 00 00 00 1a  |CAT;1.(.........|
0000c0a0  00 08 00 00 00 00 08 00  7a 09 08 06 12 30 0c 02  |........z....0..|
0000c0b0  00 00 01 00 00 01 06 4b  45 52 4e 45 4c 00 00 00  |.......KERNEL...|
0000c0c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000c800  22 00 19 00 00 00 00 00  00 19 00 08 00 00 00 00  |"...............|
0000c810  08 00 7a 09 08 0a 1a 1e  0c 02 00 00 01 00 00 01  |..z.............|
0000c820  01 00 22 00 18 00 00 00  00 00 00 18 00 08 00 00  |..".............|
0000c830  00 00 08 00 7a 09 08 04  2c 13 0c 02 00 00 01 00  |....z...,.......|
0000c840  00 01 01 01 2c 00 1c 00  00 00 00 00 00 1c e2 0b  |....,...........|
0000c850  00 00 00 00 0b e2 7a 09  08 0a 1b 0a 0c 00 00 00  |......z.........|
0000c860  01 00 00 01 0a 42 4f 4f  54 2e 42 49 4e 3b 31 00  |.....BOOT.BIN;1.|
0000c870  2e 00 1e 00 00 00 00 00  00 1e ba 0a 00 00 00 00  |................|
0000c880  0a ba 7a 09 03 00 27 30  0c 00 00 00 01 00 00 01  |..z...'0........|
0000c890  0d 42 4f 4f 54 5f 43 44  2e 41 53 4d 3b 31 00 00  |.BOOT_CD.ASM;1..|
0000c8a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d000  22 00 1a 00 00 00 00 00  00 1a 00 08 00 00 00 00  |"...............|
0000d010  08 00 7a 09 08 06 12 30  0c 02 00 00 01 00 00 01  |..z....0........|
0000d020  01 00 22 00 18 00 00 00  00 00 00 18 00 08 00 00  |..".............|
0000d030  00 00 08 00 7a 09 08 04  2c 13 0c 02 00 00 01 00  |....z...,.......|
0000d040  00 01 01 01 2e 00 20 00  00 00 00 00 00 20 00 02  |...... ...... ..|
0000d050  00 00 00 00 02 00 7a 09  08 0a 0d 38 0c 00 00 00  |......z....8....|
0000d060  01 00 00 01 0c 4b 45 52  4e 45 4c 2e 42 49 4e 3b  |.....KERNEL.BIN;|
0000d070  31 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |1...............|
0000d080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d800  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
0000d810  00 00 00 00 00 00 00 00  00 00 00 00 aa 55 55 aa  |.............UU.|
0000d820  88 00 00 00 00 00 08 00  1c 00 00 00 00 00 00 00  |................|
0000d830  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000e000  e8 00 00 5b fa c1 eb 04  8e db 8e c3 bd 00 70 89  |...[..........p.|
0000e010  ec be 8c 03 e8 58 00 31  c0 31 db ba 76 01 ee 80  |.....X.1.1..v...|
0000e020  c2 80 ee fe c2 b9 0f 00  ec e2 fd fe c3 a8 04 75  |...............u|
0000e030  03 e8 1c 00 81 ea 80 00  ec fe c3 a8 04 75 03 e8  |.............u..|
0000e040  0e 00 b0 10 f6 c3 02 75  d2 be a5 03 e8 20 00 f4  |.......u..... ..|
0000e050  b0 a1 b1 05 ee ec a8 80  75 fb a8 01 e0 f7 74 01  |........u.....t.|
0000e060  c3 a8 20 75 09 a8 08 e1  ec 0f 85 93 01 c3 f4 b8  |.. u............|
0000e070  00 b8 8e e8 b4 0f 8b 1e  b7 00 3e 8a 04 46 3c 0a  |..........>..F<.|
0000e080  75 10 bb a0 0f b0 20 65  89 47 fe 83 eb 02 75 f7  |u..... e.G....u.|
0000e090  eb e8 3c 0d 75 10 89 d8  b3 a0 f6 f3 fe c0 f6 e3  |..<.u...........|
0000e0a0  89 c3 b4 0f eb d4 84 c0  74 08 65 89 07 83 c3 02  |........t.e.....|
0000e0b0  eb c8 89 1e b7 00 c3 00  00 66 50 66 53 66 51 66  |.........fPfSfQf|
0000e0c0  52 89 e3 83 ec 0a 66 b9  0a 00 00 00 66 31 d2 66  |R.....f.....f1.f|
0000e0d0  f7 f1 80 c2 30 4b 88 17  66 83 f8 00 75 ee 66 56  |....0K..f...u.fV|
0000e0e0  89 de e8 8a ff 66 5e 83  c4 0a 66 5a 66 59 66 5b  |.....f^...fZfYf[|
0000e0f0  66 58 c3 00 00 00 00 00  00 00 00 00 00 00 00 00  |fX..............|
0000e100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000e1f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
0000e200  5b 83 ea 07 be 8c 03 e8  65 fe bf e2 0b b9 00 01  |[.......e.......|
0000e210  f3 6d bf e2 0d 66 b8 10  00 00 00 66 b9 01 00 00  |.m...f.....f....|
0000e220  00 e8 e8 00 66 a1 80 0e  66 8b 0e 88 0e bf e2 0d  |....f...f.......|
0000e230  66 c1 e9 0b e8 d5 00 bb  e2 0d 0f b6 07 01 c3 30  |f..............0|
0000e240  ed 0f b6 07 01 c3 8a 07  84 c0 0f 84 b7 00 8a 47  |...............G|
0000e250  20 3c 06 0f 94 c1 00 cd  66 8b 47 21 66 3d 4b 45  | <......f.G!f=KE|
0000e260  52 4e 0f 94 c1 00 cd 8b  47 25 3d 45 4c 0f 94 c1  |RN......G%=EL...|
0000e270  00 cd 8b 47 19 3d 3b 31  0f 95 c1 00 cd f6 c5 04  |...G.=;1........|
0000e280  74 bd 66 8b 47 02 66 8b  4f 0a bf e2 0d 66 c1 e9  |t.f.G.f.O....f..|
0000e290  0b e8 78 00 bb e2 0d 0f  b6 07 01 c3 30 ed 0f b6  |..x.........0...|
0000e2a0  07 01 c3 8a 07 84 c0 74  5c 8a 47 20 3c 0c 0f 94  |.......t\.G <...|
0000e2b0  c1 00 cd 66 8b 47 21 66  3d 4b 45 52 4e 0f 94 c1  |...f.G!f=KERN...|
0000e2c0  00 cd 66 8b 47 25 66 3d  45 4c 2e 42 0f 94 c1 00  |..f.G%f=EL.B....|
0000e2d0  cd 66 8b 47 29 66 3d 49  4e 3b 31 0f 94 c1 00 cd  |.f.G)f=IN;1.....|
0000e2e0  f6 c5 04 74 b7 66 8b 47  02 e8 cd fd 66 8b 47 0a  |...t.f.G....f.G.|
0000e2f0  66 c1 e8 09 e8 c2 fd f4  bf e2 0d 66 c1 e9 09 e8  |f..........f....|
0000e300  0a 00 e9 dd 0a be cd 03  e8 64 fd f4 66 89 ce c1  |.........d..f...|
0000e310  c9 08 c1 c8 08 66 c1 c9  10 66 c1 c8 10 c1 c9 08  |.....f...f......|
0000e320  c1 c8 08 66 a3 82 03 66  89 0e 86 03 30 c0 66 89  |...f...f....0.f.|
0000e330  f1 66 c1 e1 0a 66 83 fe  20 66 89 ce 66 d1 d1 fe  |.f...f.. f..f...|
0000e340  c2 ee 89 c8 80 c2 03 ee  fe c2 88 e0 ee 80 c2 02  |................|
0000e350  b0 a0 ee ec a8 80 75 fb  66 89 f0 66 be 80 03 00  |......u.f..f....|
0000e360  00 80 ea 07 66 b9 06 00  00 00 f3 6f 66 89 c6 b5  |....f......of...|
0000e370  ff 80 c2 07 ec e2 fd 66  89 f1 80 ea 07 f3 6d c3  |.......f......m.|
0000e380  a8 00 00 00 00 00 00 00  00 00 00 00 0a 6f 70 65  |.............ope|
0000e390  72 61 74 69 6e 67 20 73  79 73 74 65 6d 20 66 6f  |rating system fo|
0000e3a0  75 6e 64 0d 00 49 44 45  20 64 65 76 69 63 65 20  |und..IDE device |
0000e3b0  6e 6f 74 20 66 6f 75 6e  64 0d 00 49 44 45 20 64  |not found..IDE d|
0000e3c0  65 76 69 63 65 20 66 6f  75 6e 64 0d 00 6b 65 72  |evice found..ker|
0000e3d0  6e 65 6c 2e 62 69 6e 20  6e 6f 74 20 66 6f 75 6e  |nel.bin not foun|
0000e3e0  64 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |d...............|
0000e3f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000f000  62 69 74 73 20 31 36 0a  63 61 6c 6c 20 69 70 5f  |bits 16.call ip_|
0000f010  67 65 74 0a 69 70 5f 67  65 74 3a 09 09 09 0a 09  |get.ip_get:.....|
0000f020  70 6f 70 20 62 78 09 09  3b 70 75 73 68 20 49 50  |pop bx..;push IP|
0000f030  20 74 6f 20 73 74 61 63  6b 20 74 68 65 6e 20 70  | to stack then p|
0000f040  6f 70 20 69 74 20 74 6f  20 61 78 0a 09 63 6c 69  |op it to ax..cli|
0000f050  09 09 3b 77 65 20 61 73  73 75 6d 65 20 74 68 61  |..;we assume tha|
0000f060  74 20 74 68 69 73 20 62  6f 6f 74 20 73 65 63 74  |t this boot sect|
0000f070  6f 72 20 69 73 20 6c 6f  61 64 65 64 20 74 6f 20  |or is loaded to |
0000f080  61 20 61 64 64 72 65 73  73 20 64 69 76 69 73 61  |a address divisa|
0000f090  62 6c 65 20 62 79 20 31  36 0a 09 73 68 72 20 62  |ble by 16..shr b|
0000f0a0  78 2c 34 0a 09 6d 6f 76  20 64 73 2c 62 78 0a 09  |x,4..mov ds,bx..|
0000f0b0  6d 6f 76 20 65 73 2c 62  78 0a 09 6d 6f 76 20 62  |mov es,bx..mov b|
0000f0c0  70 2c 30 78 37 30 30 30  09 3b 73 65 74 20 73 74  |p,0x7000.;set st|
0000f0d0  61 63 6b 20 61 6e 64 20  62 61 73 65 20 70 6f 69  |ack and base poi|
0000f0e0  6e 74 65 72 73 0a 09 6d  6f 76 20 73 70 2c 62 70  |nters..mov sp,bp|
0000f0f0  0a 09 6d 6f 76 20 73 69  2c 6d 73 67 31 0a 09 63  |..mov si,msg1..c|
0000f100  61 6c 6c 20 5f 5f 70 72  69 6e 74 53 74 72 69 6e  |all __printStrin|
0000f110  67 78 38 36 0a 09 0a 09  78 6f 72 20 61 78 2c 61  |gx86....xor ax,a|
0000f120  78 0a 09 78 6f 72 20 62  78 2c 62 78 0a 49 44 45  |x..xor bx,bx.IDE|
0000f130  5f 53 4d 5f 53 43 41 4e  5f 4c 4f 4f 50 3a 0a 09  |_SM_SCAN_LOOP:..|
0000f140  6d 6f 76 20 64 78 2c 30  78 31 37 36 0a 09 6f 75  |mov dx,0x176..ou|
0000f150  74 20 64 78 2c 61 6c 0a  09 61 64 64 20 64 6c 2c  |t dx,al..add dl,|
0000f160  30 78 66 30 2d 30 78 37  30 09 3b 73 65 74 73 20  |0xf0-0x70.;sets |
0000f170  64 78 20 74 6f 20 30 78  31 46 36 0a 09 6f 75 74  |dx to 0x1F6..out|
0000f180  20 64 78 2c 61 6c 0a 09  0a 09 69 6e 63 20 64 6c  | dx,al....inc dl|
0000f190  0a 09 6d 6f 76 20 63 78  2c 31 35 0a 49 44 45 5f  |..mov cx,15.IDE_|
0000f1a0  44 52 49 56 45 5f 53 45  4c 45 43 54 5f 57 41 49  |DRIVE_SELECT_WAI|
0000f1b0  54 5f 4c 4f 4f 50 3a 0a  0a 09 69 6e 20 61 6c 2c  |T_LOOP:...in al,|
0000f1c0  64 78 0a 09 6c 6f 6f 70  20 49 44 45 5f 44 52 49  |dx..loop IDE_DRI|
0000f1d0  56 45 5f 53 45 4c 45 43  54 5f 57 41 49 54 5f 4c  |VE_SELECT_WAIT_L|
0000f1e0  4f 4f 50 0a 09 0a 09 69  6e 63 20 62 6c 0a 09 74  |OOP....inc bl..t|
0000f1f0  65 73 74 20 61 6c 2c 30  78 30 34 0a 09 6a 6e 7a  |est al,0x04..jnz|
0000f200  20 73 6b 69 70 5f 6c 6f  6f 70 0a 09 63 61 6c 6c  | skip_loop..call|
0000f210  20 49 44 45 5f 44 45 56  49 43 45 5f 44 45 54 45  | IDE_DEVICE_DETE|
0000f220  43 54 45 44 0a 73 6b 69  70 5f 6c 6f 6f 70 3a 0a  |CTED.skip_loop:.|
0000f230  09 73 75 62 20 64 78 2c  30 78 66 30 2d 30 78 37  |.sub dx,0xf0-0x7|
0000f240  30 09 3b 73 65 74 73 20  64 78 20 74 6f 20 30 78  |0.;sets dx to 0x|
0000f250  31 37 37 0a 09 69 6e 20  61 6c 2c 64 78 0a 09 69  |177..in al,dx..i|
0000f260  6e 63 20 62 6c 0a 09 74  65 73 74 20 61 6c 2c 30  |nc bl..test al,0|
0000f270  78 30 34 0a 09 6a 6e 7a  20 73 6b 69 70 5f 6c 6f  |x04..jnz skip_lo|
0000f280  6f 70 5f 32 0a 09 63 61  6c 6c 20 49 44 45 5f 44  |op_2..call IDE_D|
0000f290  45 56 49 43 45 5f 44 45  54 45 43 54 45 44 0a 73  |EVICE_DETECTED.s|
0000f2a0  6b 69 70 5f 6c 6f 6f 70  5f 32 3a 0a 09 6d 6f 76  |kip_loop_2:..mov|
0000f2b0  20 61 6c 2c 31 3c 3c 34  0a 09 74 65 73 74 20 62  | al,1<<4..test b|
0000f2c0  6c 2c 32 0a 09 6a 6e 7a  20 49 44 45 5f 53 4d 5f  |l,2..jnz IDE_SM_|
0000f2d0  53 43 41 4e 5f 4c 4f 4f  50 0a 09 0a 49 44 45 5f  |SCAN_LOOP...IDE_|
0000f2e0  44 45 56 49 43 45 5f 4e  4f 54 5f 46 4f 55 4e 44  |DEVICE_NOT_FOUND|
0000f2f0  3a 0a 09 6d 6f 76 20 73  69 2c 6d 73 67 32 0a 09  |:..mov si,msg2..|
0000f300  63 61 6c 6c 20 5f 5f 70  72 69 6e 74 53 74 72 69  |call __printStri|
0000f310  6e 67 78 38 36 0a 09 68  6c 74 0a 09 0a 49 44 45  |ngx86..hlt...IDE|
0000f320  5f 44 45 56 49 43 45 5f  44 45 54 45 43 54 45 44  |_DEVICE_DETECTED|
0000f330  3a 0a 09 0a 70 6f 72 74  5f 74 65 73 74 3a 0a 09  |:...port_test:..|
0000f340  6d 6f 76 20 61 6c 2c 30  78 61 31 0a 09 6d 6f 76  |mov al,0xa1..mov|
0000f350  20 63 6c 2c 35 0a 09 6f  75 74 20 64 78 2c 61 6c  | cl,5..out dx,al|
0000f360  0a 72 65 74 72 79 5f 6c  6f 6f 70 3a 0a 09 0a 77  |.retry_loop:...w|
0000f370  61 69 74 5f 6c 6f 6f 70  3a 0a 09 69 6e 20 61 6c  |ait_loop:..in al|
0000f380  2c 64 78 0a 09 74 65 73  74 20 61 6c 2c 31 3c 3c  |,dx..test al,1<<|
0000f390  37 09 09 3b 77 61 69 74  20 75 6e 74 69 6c 79 20  |7..;wait untily |
0000f3a0  74 68 65 20 64 72 69 76  65 20 69 73 20 6e 6f 74  |the drive is not|
0000f3b0  20 62 75 73 73 79 0a 09  6a 6e 7a 20 77 61 69 74  | bussy..jnz wait|
0000f3c0  5f 6c 6f 6f 70 0a 09 0a  09 74 65 73 74 20 61 6c  |_loop....test al|
0000f3d0  2c 31 09 09 3b 63 68 65  63 6b 20 66 6f 72 20 61  |,1..;check for a|
0000f3e0  6e 20 65 72 72 6f 72 20  69 66 20 69 74 20 65 78  |n error if it ex|
0000f3f0  69 73 74 73 20 72 65 74  72 79 20 69 74 20 61 67  |ists retry it ag|
0000f400  61 69 6e 20 75 70 20 74  6f 20 66 6f 75 72 20 74  |ain up to four t|
0000f410  69 6d 65 73 0a 09 6c 6f  6f 70 6e 7a 20 72 65 74  |imes..loopnz ret|
0000f420  72 79 5f 6c 6f 6f 70 0a  09 6a 7a 20 49 44 45 5f  |ry_loop..jz IDE_|
0000f430  44 45 56 49 43 45 5f 4e  4f 5f 45 52 52 4f 52 0a  |DEVICE_NO_ERROR.|
0000f440  09 72 65 74 0a 49 44 45  5f 44 45 56 49 43 45 5f  |.ret.IDE_DEVICE_|
0000f450  4e 4f 5f 45 52 52 4f 52  3a 0a 09 74 65 73 74 20  |NO_ERROR:..test |
0000f460  61 6c 2c 31 3c 3c 35 0a  09 6a 6e 7a 20 64 72 69  |al,1<<5..jnz dri|
0000f470  76 65 5f 66 61 75 6c 74  09 09 3b 63 68 65 63 6b  |ve_fault..;check|
0000f480  20 66 6f 72 20 61 20 64  72 69 76 65 20 66 61 75  | for a drive fau|
0000f490  6c 74 0a 09 74 65 73 74  20 61 6c 2c 31 3c 3c 33  |lt..test al,1<<3|
0000f4a0  09 09 3b 63 68 65 63 6b  20 69 66 20 64 72 69 76  |..;check if driv|
0000f4b0  65 20 69 73 20 72 65 61  64 79 20 69 66 20 6e 6f  |e is ready if no|
0000f4c0  74 20 72 65 74 72 79 20  69 74 20 61 67 61 69 6e  |t retry it again|
0000f4d0  20 75 70 20 74 6f 20 66  6f 75 72 20 74 69 6d 65  | up to four time|
0000f4e0  73 0a 09 6c 6f 6f 70 7a  20 72 65 74 72 79 5f 6c  |s..loopz retry_l|
0000f4f0  6f 6f 70 0a 09 6a 6e 7a  20 41 54 41 50 49 5f 44  |oop..jnz ATAPI_D|
0000f500  45 56 49 43 45 5f 46 4f  55 4e 44 0a 09 72 65 74  |EVICE_FOUND..ret|
0000f510  0a 09 0a 41 54 41 50 49  5f 44 45 56 49 43 45 5f  |...ATAPI_DEVICE_|
0000f520  46 4f 55 4e 44 3a 09 09  3b 73 74 6f 72 65 73 20  |FOUND:..;stores |
0000f530  74 68 65 20 69 64 65 6e  74 69 66 79 20 70 61 63  |the identify pac|
0000f540  6b 65 74 20 64 65 76 69  63 65 20 64 61 74 61 0a  |ket device data.|
0000f550  09 70 6f 70 20 62 78 0a  09 73 75 62 20 64 78 2c  |.pop bx..sub dx,|
0000f560  37 09 09 3b 73 75 62 73  74 72 61 63 74 20 37 20  |7..;substract 7 |
0000f570  74 6f 20 67 65 74 20 64  61 74 61 20 70 6f 72 74  |to get data port|
0000f580  0a 09 6d 6f 76 20 64 69  2c 49 44 45 4e 54 49 46  |..mov di,IDENTIF|
0000f590  59 5f 50 41 43 4b 45 54  5f 44 45 56 49 43 45 5f  |Y_PACKET_DEVICE_|
0000f5a0  44 41 54 41 0a 09 6d 6f  76 20 63 78 2c 32 35 36  |DATA..mov cx,256|
0000f5b0  0a 09 72 65 70 20 69 6e  73 77 09 09 3b 72 65 63  |..rep insw..;rec|
0000f5c0  69 65 76 65 20 74 68 65  20 35 31 32 20 62 79 74  |ieve the 512 byt|
0000f5d0  65 20 64 61 74 61 0a 09  6d 6f 76 20 61 78 2c 5b  |e data..mov ax,[|
0000f5e0  49 44 45 4e 54 49 46 59  5f 50 41 43 4b 45 54 5f  |IDENTIFY_PACKET_|
0000f5f0  44 45 56 49 43 45 5f 44  41 54 41 5d 0a 09 63 61  |DEVICE_DATA]..ca|
0000f600  6c 6c 20 5f 5f 62 69 6e  61 72 79 54 6f 44 65 63  |ll __binaryToDec|
0000f610  69 6d 61 6c 78 38 36 0a  09 6d 6f 76 20 73 69 2c  |imalx86..mov si,|
0000f620  65 6e 74 65 72 0a 09 63  61 6c 6c 20 5f 5f 70 72  |enter..call __pr|
0000f630  69 6e 74 53 74 72 69 6e  67 78 38 36 0a 09 6d 6f  |intStringx86..mo|
0000f640  76 20 61 78 2c 5b 49 44  45 4e 54 49 46 59 5f 50  |v ax,[IDENTIFY_P|
0000f650  41 43 4b 45 54 5f 44 45  56 49 43 45 5f 44 41 54  |ACKET_DEVICE_DAT|
0000f660  41 2b 38 32 2a 32 5d 0a  09 63 61 6c 6c 20 5f 5f  |A+82*2]..call __|
0000f670  62 69 6e 61 72 79 54 6f  44 65 63 69 6d 61 6c 78  |binaryToDecimalx|
0000f680  38 36 0a 50 41 43 4b 45  54 5f 43 4f 4d 4d 41 4e  |86.PACKET_COMMAN|
0000f690  44 3a 0a 09 78 6f 72 20  61 78 2c 61 78 0a 09 69  |D:..xor ax,ax..i|
0000f6a0  6e 63 20 64 6c 0a 09 6f  75 74 20 64 78 2c 61 6c  |nc dl..out dx,al|
0000f6b0  0a 09 61 64 64 20 64 6c  2c 33 0a 09 6f 75 74 20  |..add dl,3..out |
0000f6c0  64 78 2c 61 6c 0a 09 69  6e 63 20 64 6c 0a 09 6d  |dx,al..inc dl..m|
0000f6d0  6f 76 20 61 6c 2c 32 30  34 38 3e 3e 38 0a 09 6f  |ov al,2048>>8..o|
0000f6e0  75 74 20 64 78 2c 61 6c  0a 09 61 64 64 20 64 6c  |ut dx,al..add dl|
0000f6f0  2c 32 0a 09 6d 6f 76 20  61 6c 2c 30 78 61 30 0a  |,2..mov al,0xa0.|
0000f700  09 6f 75 74 20 64 78 2c  61 6c 0a 09 0a 09 77 61  |.out dx,al....wa|
0000f710  69 74 5f 6c 6f 6f 70 32  3a 0a 09 69 6e 20 61 6c  |it_loop2:..in al|
0000f720  2c 64 78 0a 09 74 65 73  74 20 61 6c 2c 31 3c 3c  |,dx..test al,1<<|
0000f730  37 09 09 3b 77 61 69 74  20 75 6e 74 69 6c 79 20  |7..;wait untily |
0000f740  74 68 65 20 64 72 69 76  65 20 69 73 20 6e 6f 74  |the drive is not|
0000f750  20 62 75 73 73 79 0a 09  6a 6e 7a 20 77 61 69 74  | bussy..jnz wait|
0000f760  5f 6c 6f 6f 70 32 0a 09  0a 09 73 75 62 20 64 6c  |_loop2....sub dl|
0000f770  2c 37 0a 09 6d 6f 76 20  63 6c 2c 36 0a 09 6d 6f  |,7..mov cl,6..mo|
0000f780  76 20 73 69 2c 50 41 43  4b 45 54 31 32 0a 09 72  |v si,PACKET12..r|
0000f790  65 70 20 6f 75 74 73 77  0a 09 6d 6f 76 20 63 68  |ep outsw..mov ch|
0000f7a0  2c 30 78 66 66 0a 09 61  64 64 20 64 6c 2c 37 0a  |,0xff..add dl,7.|
0000f7b0  09 49 44 45 5f 44 52 49  56 45 5f 50 41 43 4b 45  |.IDE_DRIVE_PACKE|
0000f7c0  54 5f 57 41 49 54 5f 4c  4f 4f 50 3a 09 3b 7e 33  |T_WAIT_LOOP:.;~3|
0000f7d0  6d 73 20 64 65 6c 61 79  0a 09 69 6e 20 61 6c 2c  |ms delay..in al,|
0000f7e0  64 78 0a 09 6c 6f 6f 70  20 49 44 45 5f 44 52 49  |dx..loop IDE_DRI|
0000f7f0  56 45 5f 50 41 43 4b 45  54 5f 57 41 49 54 5f 4c  |VE_PACKET_WAIT_L|
0000f800  4f 4f 50 0a 09 73 75 62  20 64 6c 2c 37 0a 09 6d  |OOP..sub dl,7..m|
0000f810  6f 76 20 63 68 2c 31 30  32 34 3e 3e 38 0a 09 6d  |ov ch,1024>>8..m|
0000f820  6f 76 20 64 69 2c 64 61  74 61 5f 74 65 73 74 0a  |ov di,data_test.|
0000f830  09 72 65 70 20 69 6e 73  77 0a 09 0a 09 6d 6f 76  |.rep insw....mov|
0000f840  20 63 78 2c 31 36 0a 09  6d 6f 76 20 62 78 2c 64  | cx,16..mov bx,d|
0000f850  61 74 61 5f 74 65 73 74  0a 09 6d 6f 76 20 73 69  |ata_test..mov si|
0000f860  2c 65 6e 74 65 72 0a 09  0a 09 63 61 6c 6c 20 5f  |,enter....call _|
0000f870  5f 70 72 69 6e 74 53 74  72 69 6e 67 78 38 36 0a  |_printStringx86.|
0000f880  09 6d 6f 76 20 61 78 2c  64 78 0a 09 63 61 6c 6c  |.mov ax,dx..call|
0000f890  20 5f 5f 62 69 6e 61 72  79 54 6f 44 65 63 69 6d  | __binaryToDecim|
0000f8a0  61 6c 78 38 36 0a 09 63  61 6c 6c 20 5f 5f 70 72  |alx86..call __pr|
0000f8b0  69 6e 74 53 74 72 69 6e  67 78 38 36 0a 64 69 73  |intStringx86.dis|
0000f8c0  70 6c 61 79 5f 74 65 73  74 5f 6c 6f 6f 70 3a 0a  |play_test_loop:.|
0000f8d0  09 6d 6f 76 20 65 61 78  2c 5b 62 78 5d 0a 09 61  |.mov eax,[bx]..a|
0000f8e0  64 64 20 62 78 2c 34 0a  09 63 61 6c 6c 20 5f 5f  |dd bx,4..call __|
0000f8f0  62 69 6e 61 72 79 54 6f  44 65 63 69 6d 61 6c 78  |binaryToDecimalx|
0000f900  38 36 0a 09 63 61 6c 6c  20 5f 5f 70 72 69 6e 74  |86..call __print|
0000f910  53 74 72 69 6e 67 78 38  36 0a 09 6c 6f 6f 70 20  |Stringx86..loop |
0000f920  64 69 73 70 6c 61 79 5f  74 65 73 74 5f 6c 6f 6f  |display_test_loo|
0000f930  70 0a 09 68 6c 74 0a 64  72 69 76 65 5f 66 61 75  |p..hlt.drive_fau|
0000f940  6c 74 3a 0a 09 0a 09 68  6c 74 0a 0a 09 25 69 6e  |lt:....hlt...%in|
0000f950  63 6c 75 64 65 20 22 2e  2e 2f 66 75 6e 63 74 69  |clude "../functi|
0000f960  6f 6e 73 2f 5f 5f 70 72  69 6e 74 53 74 72 69 6e  |ons/__printStrin|
0000f970  67 78 38 36 2e 61 73 6d  22 0a 09 25 69 6e 63 6c  |gx86.asm"..%incl|
0000f980  75 64 65 20 22 2e 2e 2f  66 75 6e 63 74 69 6f 6e  |ude "../function|
0000f990  73 2f 5f 5f 62 69 6e 61  72 79 54 6f 44 65 63 69  |s/__binaryToDeci|
0000f9a0  6d 61 6c 78 38 36 2e 61  73 6d 22 0a 09 0a 09 0a  |malx86.asm".....|
0000f9b0  74 69 6d 65 73 20 35 31  30 2d 28 24 2d 24 24 29  |times 510-($-$$)|
0000f9c0  20 64 62 20 30 0a 64 77  20 30 78 61 61 35 35 0a  | db 0.dw 0xaa55.|
0000f9d0  49 44 45 4e 54 49 46 59  5f 50 41 43 4b 45 54 5f  |IDENTIFY_PACKET_|
0000f9e0  44 45 56 49 43 45 5f 44  41 54 41 3a 09 74 69 6d  |DEVICE_DATA:.tim|
0000f9f0  65 73 20 32 35 36 20 64  77 20 30 0a 50 41 43 4b  |es 256 dw 0.PACK|
0000fa00  45 54 31 32 3a 09 64 62  20 30 78 61 38 2c 30 0a  |ET12:.db 0xa8,0.|
0000fa10  09 09 64 62 20 30 2c 30  2c 30 2c 31 36 0a 09 09  |..db 0,0,0,16...|
0000fa20  64 62 20 30 2c 30 2c 30  2c 31 0a 09 09 64 62 20  |db 0,0,0,1...db |
0000fa30  30 2c 30 0a 09 09 0a 50  41 43 4b 45 54 31 36 3a  |0,0....PACKET16:|
0000fa40  0a 6d 73 67 31 3a 20 64  62 20 31 30 2c 22 6f 70  |.msg1: db 10,"op|
0000fa50  65 72 61 74 69 6e 67 20  73 79 73 74 65 6d 20 66  |erating system f|
0000fa60  6f 75 6e 64 22 0a 65 6e  74 65 72 3a 20 64 62 20  |ound".enter: db |
0000fa70  31 33 2c 30 0a 6d 73 67  32 3a 20 64 62 20 22 49  |13,0.msg2: db "I|
0000fa80  44 45 20 64 65 76 69 63  65 20 6e 6f 20 66 6f 75  |DE device no fou|
0000fa90  6e 64 22 2c 31 33 2c 30  0a 64 61 74 61 5f 74 65  |nd",13,0.data_te|
0000faa0  73 74 3a 09 64 64 09 31  2c 32 2c 33 2c 34 2c 35  |st:.dd.1,2,3,4,5|
0000fab0  2c 36 2c 37 2c 38 2c 39  0a 0a 00 00 00 00 00 00  |,6,7,8,9........|
0000fac0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00010000  e8 00 00 5b fa c1 eb 04  8e db 8e c3 bd 00 70 89  |...[..........p.|
00010010  ec be 18 00 e8 19 00 f4  6b 65 72 6e 65 6c 20 68  |........kernel h|
00010020  61 73 20 62 65 65 6e 20  6c 6f 61 64 65 64 0d 00  |as been loaded..|
00010030  b8 00 b8 8e e8 b4 0f 8b  1e 79 00 3e 8a 04 46 3c  |.........y.>..F<|
00010040  0a 75 10 bb a0 0f b0 20  65 89 47 fe 83 eb 02 75  |.u..... e.G....u|
00010050  f7 eb e8 3c 0d 75 10 89  d8 b3 a0 f6 f3 fe c0 f6  |...<.u..........|
00010060  e3 89 c3 b4 0f eb d4 84  c0 74 09 83 c3 02 65 89  |.........t....e.|
00010070  47 fe eb c7 89 1e 79 00  c3 00 00 00 00 00 00 00  |G.....y.........|
00010080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000101f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
00010200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000127c4
