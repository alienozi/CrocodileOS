00008000  01 43 44 30 30 31 01 00  4c 49 4e 55 58 20 20 20  |.CD001..LINUX   |
00008010  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00008020  20 20 20 20 20 20 20 20  43 44 52 4f 4d 20 20 20  |        CDROM   |
00008030  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00008040  20 20 20 20 20 20 20 20  00 00 00 00 00 00 00 00  |        ........|
00008050  b3 00 00 00 00 00 00 b3  00 00 00 00 00 00 00 00  |................|
00008060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00008070  00 00 00 00 00 00 00 00  01 00 00 01 01 00 00 01  |................|
00008080  00 08 08 00 0a 00 00 00  00 00 00 0a 14 00 00 00  |................|
00008090  00 00 00 00 00 00 00 16  00 00 00 00 22 00 18 00  |............"...|
000080a0  00 00 00 00 00 18 00 08  00 00 00 00 08 00 7a 09  |..............z.|
000080b0  03 02 2a 18 0c 02 00 00  01 00 00 01 01 00 20 20  |..*...........  |
000080c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008230  20 20 20 20 20 20 20 20  20 20 20 20 20 20 47 45  |              GE|
00008240  4e 49 53 4f 49 4d 41 47  45 20 49 53 4f 20 39 36  |NISOIMAGE ISO 96|
00008250  36 30 2f 48 46 53 20 46  49 4c 45 53 59 53 54 45  |60/HFS FILESYSTE|
00008260  4d 20 43 52 45 41 54 4f  52 20 28 43 29 20 31 39  |M CREATOR (C) 19|
00008270  39 33 20 45 2e 59 4f 55  4e 47 44 41 4c 45 20 28  |93 E.YOUNGDALE (|
00008280  43 29 20 31 39 39 37 2d  32 30 30 36 20 4a 2e 50  |C) 1997-2006 J.P|
00008290  45 41 52 53 4f 4e 2f 4a  2e 53 43 48 49 4c 4c 49  |EARSON/J.SCHILLI|
000082a0  4e 47 20 28 43 29 20 32  30 30 36 2d 32 30 30 37  |NG (C) 2006-2007|
000082b0  20 43 44 52 4b 49 54 20  54 45 41 4d 20 20 20 20  | CDRKIT TEAM    |
000082c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008320  20 20 20 20 20 20 20 20  20 20 20 20 20 32 30 32  |             202|
00008330  32 30 39 30 33 30 32 34  32 33 31 30 30 0c 32 30  |2090302423100.20|
00008340  32 32 30 39 30 33 30 32  34 32 33 31 30 30 0c 30  |22090302423100.0|
00008350  30 30 30 30 30 30 30 30  30 30 30 30 30 30 30 00  |000000000000000.|
00008360  32 30 32 32 30 39 30 33  30 32 34 32 33 31 30 30  |2022090302423100|
00008370  0c 01 00 20 20 20 20 20  20 20 20 20 20 20 20 20  |...             |
00008380  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008570  20 20 20 00 00 00 00 00  00 00 00 00 00 00 00 00  |   .............|
00008580  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008800  00 43 44 30 30 31 01 45  4c 20 54 4f 52 49 54 4f  |.CD001.EL TORITO|
00008810  20 53 50 45 43 49 46 49  43 41 54 49 4f 4e 00 00  | SPECIFICATION..|
00008820  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008840  00 00 00 00 00 00 00 19  00 00 00 00 00 00 00 00  |................|
00008850  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00009000  ff 43 44 30 30 31 01 00  00 00 00 00 00 00 00 00  |.CD001..........|
00009010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000a000  01 00 18 00 00 00 01 00  00 00 00 00 00 00 00 00  |................|
0000a010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000b000  01 00 00 00 00 18 00 01  00 00 00 00 00 00 00 00  |................|
0000b010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000c000  22 00 18 00 00 00 00 00  00 18 00 08 00 00 00 00  |"...............|
0000c010  08 00 7a 09 03 02 2a 18  0c 02 00 00 01 00 00 01  |..z...*.........|
0000c020  01 00 22 00 18 00 00 00  00 00 00 18 00 08 00 00  |..".............|
0000c030  00 00 08 00 7a 09 03 02  2a 1f 0c 02 00 00 01 00  |....z...*.......|
0000c040  00 01 01 01 2c 00 19 00  00 00 00 00 00 19 00 08  |....,...........|
0000c050  00 00 00 00 08 00 7a 09  03 02 2a 1f 0c 00 00 00  |......z...*.....|
0000c060  01 00 00 01 0a 42 4f 4f  54 2e 43 41 54 3b 31 00  |.....BOOT.CAT;1.|
0000c070  2e 00 1b 00 00 00 00 00  00 1b ba 0a 00 00 00 00  |................|
0000c080  0a ba 7a 09 03 00 27 30  0c 00 00 00 01 00 00 01  |..z...'0........|
0000c090  0d 42 4f 4f 54 5f 43 44  2e 41 53 4d 3b 31 2c 00  |.BOOT_CD.ASM;1,.|
0000c0a0  1a 00 00 00 00 00 00 1a  00 02 00 00 00 00 02 00  |................|
0000c0b0  7a 09 03 00 1d 21 0c 00  00 00 01 00 00 01 0a 54  |z....!.........T|
0000c0c0  45 53 54 2e 42 49 4e 3b  31 00 00 00 00 00 00 00  |EST.BIN;1.......|
0000c0d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000c800  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
0000c810  00 00 00 00 00 00 00 00  00 00 00 00 aa 55 55 aa  |.............UU.|
0000c820  88 00 00 00 00 00 04 00  1a 00 00 00 00 00 00 00  |................|
0000c830  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d000  bd 00 80 89 ec b9 0a 00  bb 12 7c e8 0d 00 e2 fb  |..........|.....|
0000d010  eb fe 41 4d 4f 47 55 53  0a 0d 00 50 53 b4 0e 8a  |..AMOGUS...PS...|
0000d020  07 3c 00 74 05 cd 10 43  eb f5 5b 58 c3 00 00 00  |.<.t...C..[X....|
0000d030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d1f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
0000d200  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d800  62 69 74 73 20 31 36 0a  63 61 6c 6c 20 69 70 5f  |bits 16.call ip_|
0000d810  67 65 74 0a 69 70 5f 67  65 74 3a 09 09 09 0a 09  |get.ip_get:.....|
0000d820  70 6f 70 20 62 78 09 09  3b 70 75 73 68 20 49 50  |pop bx..;push IP|
0000d830  20 74 6f 20 73 74 61 63  6b 20 74 68 65 6e 20 70  | to stack then p|
0000d840  6f 70 20 69 74 20 74 6f  20 61 78 0a 09 63 6c 69  |op it to ax..cli|
0000d850  09 09 3b 77 65 20 61 73  73 75 6d 65 20 74 68 61  |..;we assume tha|
0000d860  74 20 74 68 69 73 20 62  6f 6f 74 20 73 65 63 74  |t this boot sect|
0000d870  6f 72 20 69 73 20 6c 6f  61 64 65 64 20 74 6f 20  |or is loaded to |
0000d880  61 20 61 64 64 72 65 73  73 20 64 69 76 69 73 61  |a address divisa|
0000d890  62 6c 65 20 62 79 20 31  36 0a 09 73 68 72 20 62  |ble by 16..shr b|
0000d8a0  78 2c 34 0a 09 6d 6f 76  20 64 73 2c 62 78 0a 09  |x,4..mov ds,bx..|
0000d8b0  6d 6f 76 20 65 73 2c 62  78 0a 09 6d 6f 76 20 62  |mov es,bx..mov b|
0000d8c0  70 2c 30 78 37 30 30 30  09 3b 73 65 74 20 73 74  |p,0x7000.;set st|
0000d8d0  61 63 6b 20 61 6e 64 20  62 61 73 65 20 70 6f 69  |ack and base poi|
0000d8e0  6e 74 65 72 73 0a 09 6d  6f 76 20 73 70 2c 62 70  |nters..mov sp,bp|
0000d8f0  0a 09 6d 6f 76 20 73 69  2c 6d 73 67 31 0a 09 63  |..mov si,msg1..c|
0000d900  61 6c 6c 20 5f 5f 70 72  69 6e 74 53 74 72 69 6e  |all __printStrin|
0000d910  67 78 38 36 0a 09 0a 09  78 6f 72 20 61 78 2c 61  |gx86....xor ax,a|
0000d920  78 0a 09 78 6f 72 20 62  78 2c 62 78 0a 49 44 45  |x..xor bx,bx.IDE|
0000d930  5f 53 4d 5f 53 43 41 4e  5f 4c 4f 4f 50 3a 0a 09  |_SM_SCAN_LOOP:..|
0000d940  6d 6f 76 20 64 78 2c 30  78 31 37 36 0a 09 6f 75  |mov dx,0x176..ou|
0000d950  74 20 64 78 2c 61 6c 0a  09 61 64 64 20 64 6c 2c  |t dx,al..add dl,|
0000d960  30 78 66 30 2d 30 78 37  30 09 3b 73 65 74 73 20  |0xf0-0x70.;sets |
0000d970  64 78 20 74 6f 20 30 78  31 46 36 0a 09 6f 75 74  |dx to 0x1F6..out|
0000d980  20 64 78 2c 61 6c 0a 09  0a 09 69 6e 63 20 64 6c  | dx,al....inc dl|
0000d990  0a 09 6d 6f 76 20 63 78  2c 31 35 0a 49 44 45 5f  |..mov cx,15.IDE_|
0000d9a0  44 52 49 56 45 5f 53 45  4c 45 43 54 5f 57 41 49  |DRIVE_SELECT_WAI|
0000d9b0  54 5f 4c 4f 4f 50 3a 0a  0a 09 69 6e 20 61 6c 2c  |T_LOOP:...in al,|
0000d9c0  64 78 0a 09 6c 6f 6f 70  20 49 44 45 5f 44 52 49  |dx..loop IDE_DRI|
0000d9d0  56 45 5f 53 45 4c 45 43  54 5f 57 41 49 54 5f 4c  |VE_SELECT_WAIT_L|
0000d9e0  4f 4f 50 0a 09 0a 09 69  6e 63 20 62 6c 0a 09 74  |OOP....inc bl..t|
0000d9f0  65 73 74 20 61 6c 2c 30  78 30 34 0a 09 6a 6e 7a  |est al,0x04..jnz|
0000da00  20 73 6b 69 70 5f 6c 6f  6f 70 0a 09 63 61 6c 6c  | skip_loop..call|
0000da10  20 49 44 45 5f 44 45 56  49 43 45 5f 44 45 54 45  | IDE_DEVICE_DETE|
0000da20  43 54 45 44 0a 73 6b 69  70 5f 6c 6f 6f 70 3a 0a  |CTED.skip_loop:.|
0000da30  09 73 75 62 20 64 78 2c  30 78 66 30 2d 30 78 37  |.sub dx,0xf0-0x7|
0000da40  30 09 3b 73 65 74 73 20  64 78 20 74 6f 20 30 78  |0.;sets dx to 0x|
0000da50  31 37 37 0a 09 69 6e 20  61 6c 2c 64 78 0a 09 69  |177..in al,dx..i|
0000da60  6e 63 20 62 6c 0a 09 74  65 73 74 20 61 6c 2c 30  |nc bl..test al,0|
0000da70  78 30 34 0a 09 6a 6e 7a  20 73 6b 69 70 5f 6c 6f  |x04..jnz skip_lo|
0000da80  6f 70 5f 32 0a 09 63 61  6c 6c 20 49 44 45 5f 44  |op_2..call IDE_D|
0000da90  45 56 49 43 45 5f 44 45  54 45 43 54 45 44 0a 73  |EVICE_DETECTED.s|
0000daa0  6b 69 70 5f 6c 6f 6f 70  5f 32 3a 0a 09 6d 6f 76  |kip_loop_2:..mov|
0000dab0  20 61 6c 2c 31 3c 3c 34  0a 09 74 65 73 74 20 62  | al,1<<4..test b|
0000dac0  6c 2c 32 0a 09 6a 6e 7a  20 49 44 45 5f 53 4d 5f  |l,2..jnz IDE_SM_|
0000dad0  53 43 41 4e 5f 4c 4f 4f  50 0a 09 0a 49 44 45 5f  |SCAN_LOOP...IDE_|
0000dae0  44 45 56 49 43 45 5f 4e  4f 54 5f 46 4f 55 4e 44  |DEVICE_NOT_FOUND|
0000daf0  3a 0a 09 6d 6f 76 20 73  69 2c 6d 73 67 32 0a 09  |:..mov si,msg2..|
0000db00  63 61 6c 6c 20 5f 5f 70  72 69 6e 74 53 74 72 69  |call __printStri|
0000db10  6e 67 78 38 36 0a 09 68  6c 74 0a 09 0a 49 44 45  |ngx86..hlt...IDE|
0000db20  5f 44 45 56 49 43 45 5f  44 45 54 45 43 54 45 44  |_DEVICE_DETECTED|
0000db30  3a 0a 09 0a 70 6f 72 74  5f 74 65 73 74 3a 0a 09  |:...port_test:..|
0000db40  6d 6f 76 20 61 6c 2c 30  78 61 31 0a 09 6d 6f 76  |mov al,0xa1..mov|
0000db50  20 63 6c 2c 35 0a 09 6f  75 74 20 64 78 2c 61 6c  | cl,5..out dx,al|
0000db60  0a 72 65 74 72 79 5f 6c  6f 6f 70 3a 0a 09 0a 77  |.retry_loop:...w|
0000db70  61 69 74 5f 6c 6f 6f 70  3a 0a 09 69 6e 20 61 6c  |ait_loop:..in al|
0000db80  2c 64 78 0a 09 74 65 73  74 20 61 6c 2c 31 3c 3c  |,dx..test al,1<<|
0000db90  37 09 09 3b 77 61 69 74  20 75 6e 74 69 6c 79 20  |7..;wait untily |
0000dba0  74 68 65 20 64 72 69 76  65 20 69 73 20 6e 6f 74  |the drive is not|
0000dbb0  20 62 75 73 73 79 0a 09  6a 6e 7a 20 77 61 69 74  | bussy..jnz wait|
0000dbc0  5f 6c 6f 6f 70 0a 09 0a  09 74 65 73 74 20 61 6c  |_loop....test al|
0000dbd0  2c 31 09 09 3b 63 68 65  63 6b 20 66 6f 72 20 61  |,1..;check for a|
0000dbe0  6e 20 65 72 72 6f 72 20  69 66 20 69 74 20 65 78  |n error if it ex|
0000dbf0  69 73 74 73 20 72 65 74  72 79 20 69 74 20 61 67  |ists retry it ag|
0000dc00  61 69 6e 20 75 70 20 74  6f 20 66 6f 75 72 20 74  |ain up to four t|
0000dc10  69 6d 65 73 0a 09 6c 6f  6f 70 6e 7a 20 72 65 74  |imes..loopnz ret|
0000dc20  72 79 5f 6c 6f 6f 70 0a  09 6a 7a 20 49 44 45 5f  |ry_loop..jz IDE_|
0000dc30  44 45 56 49 43 45 5f 4e  4f 5f 45 52 52 4f 52 0a  |DEVICE_NO_ERROR.|
0000dc40  09 72 65 74 0a 49 44 45  5f 44 45 56 49 43 45 5f  |.ret.IDE_DEVICE_|
0000dc50  4e 4f 5f 45 52 52 4f 52  3a 0a 09 74 65 73 74 20  |NO_ERROR:..test |
0000dc60  61 6c 2c 31 3c 3c 35 0a  09 6a 6e 7a 20 64 72 69  |al,1<<5..jnz dri|
0000dc70  76 65 5f 66 61 75 6c 74  09 09 3b 63 68 65 63 6b  |ve_fault..;check|
0000dc80  20 66 6f 72 20 61 20 64  72 69 76 65 20 66 61 75  | for a drive fau|
0000dc90  6c 74 0a 09 74 65 73 74  20 61 6c 2c 31 3c 3c 33  |lt..test al,1<<3|
0000dca0  09 09 3b 63 68 65 63 6b  20 69 66 20 64 72 69 76  |..;check if driv|
0000dcb0  65 20 69 73 20 72 65 61  64 79 20 69 66 20 6e 6f  |e is ready if no|
0000dcc0  74 20 72 65 74 72 79 20  69 74 20 61 67 61 69 6e  |t retry it again|
0000dcd0  20 75 70 20 74 6f 20 66  6f 75 72 20 74 69 6d 65  | up to four time|
0000dce0  73 0a 09 6c 6f 6f 70 7a  20 72 65 74 72 79 5f 6c  |s..loopz retry_l|
0000dcf0  6f 6f 70 0a 09 6a 6e 7a  20 41 54 41 50 49 5f 44  |oop..jnz ATAPI_D|
0000dd00  45 56 49 43 45 5f 46 4f  55 4e 44 0a 09 72 65 74  |EVICE_FOUND..ret|
0000dd10  0a 09 0a 41 54 41 50 49  5f 44 45 56 49 43 45 5f  |...ATAPI_DEVICE_|
0000dd20  46 4f 55 4e 44 3a 09 09  3b 73 74 6f 72 65 73 20  |FOUND:..;stores |
0000dd30  74 68 65 20 69 64 65 6e  74 69 66 79 20 70 61 63  |the identify pac|
0000dd40  6b 65 74 20 64 65 76 69  63 65 20 64 61 74 61 0a  |ket device data.|
0000dd50  09 70 6f 70 20 62 78 0a  09 73 75 62 20 64 78 2c  |.pop bx..sub dx,|
0000dd60  37 09 09 3b 73 75 62 73  74 72 61 63 74 20 37 20  |7..;substract 7 |
0000dd70  74 6f 20 67 65 74 20 64  61 74 61 20 70 6f 72 74  |to get data port|
0000dd80  0a 09 6d 6f 76 20 64 69  2c 49 44 45 4e 54 49 46  |..mov di,IDENTIF|
0000dd90  59 5f 50 41 43 4b 45 54  5f 44 45 56 49 43 45 5f  |Y_PACKET_DEVICE_|
0000dda0  44 41 54 41 0a 09 6d 6f  76 20 63 78 2c 32 35 36  |DATA..mov cx,256|
0000ddb0  0a 09 72 65 70 20 69 6e  73 77 09 09 3b 72 65 63  |..rep insw..;rec|
0000ddc0  69 65 76 65 20 74 68 65  20 35 31 32 20 62 79 74  |ieve the 512 byt|
0000ddd0  65 20 64 61 74 61 0a 09  6d 6f 76 20 61 78 2c 5b  |e data..mov ax,[|
0000dde0  49 44 45 4e 54 49 46 59  5f 50 41 43 4b 45 54 5f  |IDENTIFY_PACKET_|
0000ddf0  44 45 56 49 43 45 5f 44  41 54 41 5d 0a 09 63 61  |DEVICE_DATA]..ca|
0000de00  6c 6c 20 5f 5f 62 69 6e  61 72 79 54 6f 44 65 63  |ll __binaryToDec|
0000de10  69 6d 61 6c 78 38 36 0a  09 6d 6f 76 20 73 69 2c  |imalx86..mov si,|
0000de20  65 6e 74 65 72 0a 09 63  61 6c 6c 20 5f 5f 70 72  |enter..call __pr|
0000de30  69 6e 74 53 74 72 69 6e  67 78 38 36 0a 09 6d 6f  |intStringx86..mo|
0000de40  76 20 61 78 2c 5b 49 44  45 4e 54 49 46 59 5f 50  |v ax,[IDENTIFY_P|
0000de50  41 43 4b 45 54 5f 44 45  56 49 43 45 5f 44 41 54  |ACKET_DEVICE_DAT|
0000de60  41 2b 38 32 2a 32 5d 0a  09 63 61 6c 6c 20 5f 5f  |A+82*2]..call __|
0000de70  62 69 6e 61 72 79 54 6f  44 65 63 69 6d 61 6c 78  |binaryToDecimalx|
0000de80  38 36 0a 50 41 43 4b 45  54 5f 43 4f 4d 4d 41 4e  |86.PACKET_COMMAN|
0000de90  44 3a 0a 09 78 6f 72 20  61 78 2c 61 78 0a 09 69  |D:..xor ax,ax..i|
0000dea0  6e 63 20 64 6c 0a 09 6f  75 74 20 64 78 2c 61 6c  |nc dl..out dx,al|
0000deb0  0a 09 61 64 64 20 64 6c  2c 33 0a 09 6f 75 74 20  |..add dl,3..out |
0000dec0  64 78 2c 61 6c 0a 09 69  6e 63 20 64 6c 0a 09 6d  |dx,al..inc dl..m|
0000ded0  6f 76 20 61 6c 2c 32 30  34 38 3e 3e 38 0a 09 6f  |ov al,2048>>8..o|
0000dee0  75 74 20 64 78 2c 61 6c  0a 09 61 64 64 20 64 6c  |ut dx,al..add dl|
0000def0  2c 32 0a 09 6d 6f 76 20  61 6c 2c 30 78 61 30 0a  |,2..mov al,0xa0.|
0000df00  09 6f 75 74 20 64 78 2c  61 6c 0a 09 0a 09 77 61  |.out dx,al....wa|
0000df10  69 74 5f 6c 6f 6f 70 32  3a 0a 09 69 6e 20 61 6c  |it_loop2:..in al|
0000df20  2c 64 78 0a 09 74 65 73  74 20 61 6c 2c 31 3c 3c  |,dx..test al,1<<|
0000df30  37 09 09 3b 77 61 69 74  20 75 6e 74 69 6c 79 20  |7..;wait untily |
0000df40  74 68 65 20 64 72 69 76  65 20 69 73 20 6e 6f 74  |the drive is not|
0000df50  20 62 75 73 73 79 0a 09  6a 6e 7a 20 77 61 69 74  | bussy..jnz wait|
0000df60  5f 6c 6f 6f 70 32 0a 09  0a 09 73 75 62 20 64 6c  |_loop2....sub dl|
0000df70  2c 37 0a 09 6d 6f 76 20  63 6c 2c 36 0a 09 6d 6f  |,7..mov cl,6..mo|
0000df80  76 20 73 69 2c 50 41 43  4b 45 54 31 32 0a 09 72  |v si,PACKET12..r|
0000df90  65 70 20 6f 75 74 73 77  0a 09 6d 6f 76 20 63 68  |ep outsw..mov ch|
0000dfa0  2c 30 78 66 66 0a 09 61  64 64 20 64 6c 2c 37 0a  |,0xff..add dl,7.|
0000dfb0  09 49 44 45 5f 44 52 49  56 45 5f 50 41 43 4b 45  |.IDE_DRIVE_PACKE|
0000dfc0  54 5f 57 41 49 54 5f 4c  4f 4f 50 3a 09 3b 7e 33  |T_WAIT_LOOP:.;~3|
0000dfd0  6d 73 20 64 65 6c 61 79  0a 09 69 6e 20 61 6c 2c  |ms delay..in al,|
0000dfe0  64 78 0a 09 6c 6f 6f 70  20 49 44 45 5f 44 52 49  |dx..loop IDE_DRI|
0000dff0  56 45 5f 50 41 43 4b 45  54 5f 57 41 49 54 5f 4c  |VE_PACKET_WAIT_L|
0000e000  4f 4f 50 0a 09 73 75 62  20 64 6c 2c 37 0a 09 6d  |OOP..sub dl,7..m|
0000e010  6f 76 20 63 68 2c 31 30  32 34 3e 3e 38 0a 09 6d  |ov ch,1024>>8..m|
0000e020  6f 76 20 64 69 2c 64 61  74 61 5f 74 65 73 74 0a  |ov di,data_test.|
0000e030  09 72 65 70 20 69 6e 73  77 0a 09 0a 09 6d 6f 76  |.rep insw....mov|
0000e040  20 63 78 2c 31 36 0a 09  6d 6f 76 20 62 78 2c 64  | cx,16..mov bx,d|
0000e050  61 74 61 5f 74 65 73 74  0a 09 6d 6f 76 20 73 69  |ata_test..mov si|
0000e060  2c 65 6e 74 65 72 0a 09  0a 09 63 61 6c 6c 20 5f  |,enter....call _|
0000e070  5f 70 72 69 6e 74 53 74  72 69 6e 67 78 38 36 0a  |_printStringx86.|
0000e080  09 6d 6f 76 20 61 78 2c  64 78 0a 09 63 61 6c 6c  |.mov ax,dx..call|
0000e090  20 5f 5f 62 69 6e 61 72  79 54 6f 44 65 63 69 6d  | __binaryToDecim|
0000e0a0  61 6c 78 38 36 0a 09 63  61 6c 6c 20 5f 5f 70 72  |alx86..call __pr|
0000e0b0  69 6e 74 53 74 72 69 6e  67 78 38 36 0a 64 69 73  |intStringx86.dis|
0000e0c0  70 6c 61 79 5f 74 65 73  74 5f 6c 6f 6f 70 3a 0a  |play_test_loop:.|
0000e0d0  09 6d 6f 76 20 65 61 78  2c 5b 62 78 5d 0a 09 61  |.mov eax,[bx]..a|
0000e0e0  64 64 20 62 78 2c 34 0a  09 63 61 6c 6c 20 5f 5f  |dd bx,4..call __|
0000e0f0  62 69 6e 61 72 79 54 6f  44 65 63 69 6d 61 6c 78  |binaryToDecimalx|
0000e100  38 36 0a 09 63 61 6c 6c  20 5f 5f 70 72 69 6e 74  |86..call __print|
0000e110  53 74 72 69 6e 67 78 38  36 0a 09 6c 6f 6f 70 20  |Stringx86..loop |
0000e120  64 69 73 70 6c 61 79 5f  74 65 73 74 5f 6c 6f 6f  |display_test_loo|
0000e130  70 0a 09 68 6c 74 0a 64  72 69 76 65 5f 66 61 75  |p..hlt.drive_fau|
0000e140  6c 74 3a 0a 09 0a 09 68  6c 74 0a 0a 09 25 69 6e  |lt:....hlt...%in|
0000e150  63 6c 75 64 65 20 22 2e  2e 2f 66 75 6e 63 74 69  |clude "../functi|
0000e160  6f 6e 73 2f 5f 5f 70 72  69 6e 74 53 74 72 69 6e  |ons/__printStrin|
0000e170  67 78 38 36 2e 61 73 6d  22 0a 09 25 69 6e 63 6c  |gx86.asm"..%incl|
0000e180  75 64 65 20 22 2e 2e 2f  66 75 6e 63 74 69 6f 6e  |ude "../function|
0000e190  73 2f 5f 5f 62 69 6e 61  72 79 54 6f 44 65 63 69  |s/__binaryToDeci|
0000e1a0  6d 61 6c 78 38 36 2e 61  73 6d 22 0a 09 0a 09 0a  |malx86.asm".....|
0000e1b0  74 69 6d 65 73 20 35 31  30 2d 28 24 2d 24 24 29  |times 510-($-$$)|
0000e1c0  20 64 62 20 30 0a 64 77  20 30 78 61 61 35 35 0a  | db 0.dw 0xaa55.|
0000e1d0  49 44 45 4e 54 49 46 59  5f 50 41 43 4b 45 54 5f  |IDENTIFY_PACKET_|
0000e1e0  44 45 56 49 43 45 5f 44  41 54 41 3a 09 74 69 6d  |DEVICE_DATA:.tim|
0000e1f0  65 73 20 32 35 36 20 64  77 20 30 0a 50 41 43 4b  |es 256 dw 0.PACK|
0000e200  45 54 31 32 3a 09 64 62  20 30 78 61 38 2c 30 0a  |ET12:.db 0xa8,0.|
0000e210  09 09 64 62 20 30 2c 30  2c 30 2c 31 36 0a 09 09  |..db 0,0,0,16...|
0000e220  64 62 20 30 2c 30 2c 30  2c 31 0a 09 09 64 62 20  |db 0,0,0,1...db |
0000e230  30 2c 30 0a 09 09 0a 50  41 43 4b 45 54 31 36 3a  |0,0....PACKET16:|
0000e240  0a 6d 73 67 31 3a 20 64  62 20 31 30 2c 22 6f 70  |.msg1: db 10,"op|
0000e250  65 72 61 74 69 6e 67 20  73 79 73 74 65 6d 20 66  |erating system f|
0000e260  6f 75 6e 64 22 0a 65 6e  74 65 72 3a 20 64 62 20  |ound".enter: db |
0000e270  31 33 2c 30 0a 6d 73 67  32 3a 20 64 62 20 22 49  |13,0.msg2: db "I|
0000e280  44 45 20 64 65 76 69 63  65 20 6e 6f 20 66 6f 75  |DE device no fou|
0000e290  6e 64 22 2c 31 33 2c 30  0a 64 61 74 61 5f 74 65  |nd",13,0.data_te|
0000e2a0  73 74 3a 09 64 64 09 31  2c 32 2c 33 2c 34 2c 35  |st:.dd.1,2,3,4,5|
0000e2b0  2c 36 2c 37 2c 38 2c 39  0a 0a 00 00 00 00 00 00  |,6,7,8,9........|
0000e2c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00010000
00008000  01 43 44 30 30 31 01 00  4c 49 4e 55 58 20 20 20  |.CD001..LINUX   |
00008010  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00008020  20 20 20 20 20 20 20 20  43 44 52 4f 4d 20 20 20  |        CDROM   |
00008030  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
00008040  20 20 20 20 20 20 20 20  00 00 00 00 00 00 00 00  |        ........|
00008050  b4 00 00 00 00 00 00 b4  00 00 00 00 00 00 00 00  |................|
00008060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00008070  00 00 00 00 00 00 00 00  01 00 00 01 01 00 00 01  |................|
00008080  00 08 08 00 16 00 00 00  00 00 00 16 14 00 00 00  |................|
00008090  00 00 00 00 00 00 00 16  00 00 00 00 22 00 18 00  |............"...|
000080a0  00 00 00 00 00 18 00 08  00 00 00 00 08 00 7a 09  |..............z.|
000080b0  04 15 0b 13 0c 02 00 00  01 00 00 01 01 00 20 20  |..............  |
000080c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008230  20 20 20 20 20 20 20 20  20 20 20 20 20 20 47 45  |              GE|
00008240  4e 49 53 4f 49 4d 41 47  45 20 49 53 4f 20 39 36  |NISOIMAGE ISO 96|
00008250  36 30 2f 48 46 53 20 46  49 4c 45 53 59 53 54 45  |60/HFS FILESYSTE|
00008260  4d 20 43 52 45 41 54 4f  52 20 28 43 29 20 31 39  |M CREATOR (C) 19|
00008270  39 33 20 45 2e 59 4f 55  4e 47 44 41 4c 45 20 28  |93 E.YOUNGDALE (|
00008280  43 29 20 31 39 39 37 2d  32 30 30 36 20 4a 2e 50  |C) 1997-2006 J.P|
00008290  45 41 52 53 4f 4e 2f 4a  2e 53 43 48 49 4c 4c 49  |EARSON/J.SCHILLI|
000082a0  4e 47 20 28 43 29 20 32  30 30 36 2d 32 30 30 37  |NG (C) 2006-2007|
000082b0  20 43 44 52 4b 49 54 20  54 45 41 4d 20 20 20 20  | CDRKIT TEAM    |
000082c0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008320  20 20 20 20 20 20 20 20  20 20 20 20 20 32 30 32  |             202|
00008330  32 30 39 30 34 32 31 31  31 32 36 30 30 0c 32 30  |2090421112600.20|
00008340  32 32 30 39 30 34 32 31  31 31 32 36 30 30 0c 30  |22090421112600.0|
00008350  30 30 30 30 30 30 30 30  30 30 30 30 30 30 30 00  |000000000000000.|
00008360  32 30 32 32 30 39 30 34  32 31 31 31 32 36 30 30  |2022090421112600|
00008370  0c 01 00 20 20 20 20 20  20 20 20 20 20 20 20 20  |...             |
00008380  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |
*
00008570  20 20 20 00 00 00 00 00  00 00 00 00 00 00 00 00  |   .............|
00008580  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008800  00 43 44 30 30 31 01 45  4c 20 54 4f 52 49 54 4f  |.CD001.EL TORITO|
00008810  20 53 50 45 43 49 46 49  43 41 54 49 4f 4e 00 00  | SPECIFICATION..|
00008820  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008840  00 00 00 00 00 00 00 1a  00 00 00 00 00 00 00 00  |................|
00008850  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00009000  ff 43 44 30 30 31 01 00  00 00 00 00 00 00 00 00  |.CD001..........|
00009010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000a000  01 00 18 00 00 00 01 00  00 00 04 00 19 00 00 00  |................|
0000a010  01 00 42 4f 4f 54 00 00  00 00 00 00 00 00 00 00  |..BOOT..........|
0000a020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000b000  01 00 00 00 00 18 00 01  00 00 04 00 00 00 00 19  |................|
0000b010  00 01 42 4f 4f 54 00 00  00 00 00 00 00 00 00 00  |..BOOT..........|
0000b020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000c000  22 00 18 00 00 00 00 00  00 18 00 08 00 00 00 00  |"...............|
0000c010  08 00 7a 09 04 15 0b 13  0c 02 00 00 01 00 00 01  |..z.............|
0000c020  01 00 22 00 18 00 00 00  00 00 00 18 00 08 00 00  |..".............|
0000c030  00 00 08 00 7a 09 04 15  0b 1a 0c 02 00 00 01 00  |....z...........|
0000c040  00 01 01 01 26 00 19 00  00 00 00 00 00 19 00 08  |....&...........|
0000c050  00 00 00 00 08 00 7a 09  03 02 2a 18 0c 02 00 00  |......z...*.....|
0000c060  01 00 00 01 04 42 4f 4f  54 00 2c 00 1a 00 00 00  |.....BOOT.,.....|
0000c070  00 00 00 1a 00 08 00 00  00 00 08 00 7a 09 04 15  |............z...|
0000c080  0b 1a 0c 00 00 00 01 00  00 01 0a 42 4f 4f 54 2e  |...........BOOT.|
0000c090  43 41 54 3b 31 00 00 00  00 00 00 00 00 00 00 00  |CAT;1...........|
0000c0a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000c800  22 00 19 00 00 00 00 00  00 19 00 08 00 00 00 00  |"...............|
0000c810  08 00 7a 09 03 02 2a 18  0c 02 00 00 01 00 00 01  |..z...*.........|
0000c820  01 00 22 00 18 00 00 00  00 00 00 18 00 08 00 00  |..".............|
0000c830  00 00 08 00 7a 09 04 15  0b 13 0c 02 00 00 01 00  |....z...........|
0000c840  00 01 01 01 2e 00 1c 00  00 00 00 00 00 1c ba 0a  |................|
0000c850  00 00 00 00 0a ba 7a 09  03 00 27 30 0c 00 00 00  |......z...'0....|
0000c860  01 00 00 01 0d 42 4f 4f  54 5f 43 44 2e 41 53 4d  |.....BOOT_CD.ASM|
0000c870  3b 31 2c 00 1b 00 00 00  00 00 00 1b 00 02 00 00  |;1,.............|
0000c880  00 00 02 00 7a 09 03 00  1d 21 0c 00 00 00 01 00  |....z....!......|
0000c890  00 01 0a 54 45 53 54 2e  42 49 4e 3b 31 00 00 00  |...TEST.BIN;1...|
0000c8a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d000  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
0000d010  00 00 00 00 00 00 00 00  00 00 00 00 aa 55 55 aa  |.............UU.|
0000d020  88 00 00 00 00 00 04 00  1b 00 00 00 00 00 00 00  |................|
0000d030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d800  bd 00 80 89 ec b9 0a 00  bb 12 7c e8 0d 00 e2 fb  |..........|.....|
0000d810  eb fe 41 4d 4f 47 55 53  0a 0d 00 50 53 b4 0e 8a  |..AMOGUS...PS...|
0000d820  07 3c 00 74 05 cd 10 43  eb f5 5b 58 c3 00 00 00  |.<.t...C..[X....|
0000d830  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000d9f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 55 aa  |..............U.|
0000da00  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
0000e000  62 69 74 73 20 31 36 0a  63 61 6c 6c 20 69 70 5f  |bits 16.call ip_|
0000e010  67 65 74 0a 69 70 5f 67  65 74 3a 09 09 09 0a 09  |get.ip_get:.....|
0000e020  70 6f 70 20 62 78 09 09  3b 70 75 73 68 20 49 50  |pop bx..;push IP|
0000e030  20 74 6f 20 73 74 61 63  6b 20 74 68 65 6e 20 70  | to stack then p|
0000e040  6f 70 20 69 74 20 74 6f  20 61 78 0a 09 63 6c 69  |op it to ax..cli|
0000e050  09 09 3b 77 65 20 61 73  73 75 6d 65 20 74 68 61  |..;we assume tha|
0000e060  74 20 74 68 69 73 20 62  6f 6f 74 20 73 65 63 74  |t this boot sect|
0000e070  6f 72 20 69 73 20 6c 6f  61 64 65 64 20 74 6f 20  |or is loaded to |
0000e080  61 20 61 64 64 72 65 73  73 20 64 69 76 69 73 61  |a address divisa|
0000e090  62 6c 65 20 62 79 20 31  36 0a 09 73 68 72 20 62  |ble by 16..shr b|
0000e0a0  78 2c 34 0a 09 6d 6f 76  20 64 73 2c 62 78 0a 09  |x,4..mov ds,bx..|
0000e0b0  6d 6f 76 20 65 73 2c 62  78 0a 09 6d 6f 76 20 62  |mov es,bx..mov b|
0000e0c0  70 2c 30 78 37 30 30 30  09 3b 73 65 74 20 73 74  |p,0x7000.;set st|
0000e0d0  61 63 6b 20 61 6e 64 20  62 61 73 65 20 70 6f 69  |ack and base poi|
0000e0e0  6e 74 65 72 73 0a 09 6d  6f 76 20 73 70 2c 62 70  |nters..mov sp,bp|
0000e0f0  0a 09 6d 6f 76 20 73 69  2c 6d 73 67 31 0a 09 63  |..mov si,msg1..c|
0000e100  61 6c 6c 20 5f 5f 70 72  69 6e 74 53 74 72 69 6e  |all __printStrin|
0000e110  67 78 38 36 0a 09 0a 09  78 6f 72 20 61 78 2c 61  |gx86....xor ax,a|
0000e120  78 0a 09 78 6f 72 20 62  78 2c 62 78 0a 49 44 45  |x..xor bx,bx.IDE|
0000e130  5f 53 4d 5f 53 43 41 4e  5f 4c 4f 4f 50 3a 0a 09  |_SM_SCAN_LOOP:..|
0000e140  6d 6f 76 20 64 78 2c 30  78 31 37 36 0a 09 6f 75  |mov dx,0x176..ou|
0000e150  74 20 64 78 2c 61 6c 0a  09 61 64 64 20 64 6c 2c  |t dx,al..add dl,|
0000e160  30 78 66 30 2d 30 78 37  30 09 3b 73 65 74 73 20  |0xf0-0x70.;sets |
0000e170  64 78 20 74 6f 20 30 78  31 46 36 0a 09 6f 75 74  |dx to 0x1F6..out|
0000e180  20 64 78 2c 61 6c 0a 09  0a 09 69 6e 63 20 64 6c  | dx,al....inc dl|
0000e190  0a 09 6d 6f 76 20 63 78  2c 31 35 0a 49 44 45 5f  |..mov cx,15.IDE_|
0000e1a0  44 52 49 56 45 5f 53 45  4c 45 43 54 5f 57 41 49  |DRIVE_SELECT_WAI|
0000e1b0  54 5f 4c 4f 4f 50 3a 0a  0a 09 69 6e 20 61 6c 2c  |T_LOOP:...in al,|
0000e1c0  64 78 0a 09 6c 6f 6f 70  20 49 44 45 5f 44 52 49  |dx..loop IDE_DRI|
0000e1d0  56 45 5f 53 45 4c 45 43  54 5f 57 41 49 54 5f 4c  |VE_SELECT_WAIT_L|
0000e1e0  4f 4f 50 0a 09 0a 09 69  6e 63 20 62 6c 0a 09 74  |OOP....inc bl..t|
0000e1f0  65 73 74 20 61 6c 2c 30  78 30 34 0a 09 6a 6e 7a  |est al,0x04..jnz|
0000e200  20 73 6b 69 70 5f 6c 6f  6f 70 0a 09 63 61 6c 6c  | skip_loop..call|
0000e210  20 49 44 45 5f 44 45 56  49 43 45 5f 44 45 54 45  | IDE_DEVICE_DETE|
0000e220  43 54 45 44 0a 73 6b 69  70 5f 6c 6f 6f 70 3a 0a  |CTED.skip_loop:.|
0000e230  09 73 75 62 20 64 78 2c  30 78 66 30 2d 30 78 37  |.sub dx,0xf0-0x7|
0000e240  30 09 3b 73 65 74 73 20  64 78 20 74 6f 20 30 78  |0.;sets dx to 0x|
0000e250  31 37 37 0a 09 69 6e 20  61 6c 2c 64 78 0a 09 69  |177..in al,dx..i|
0000e260  6e 63 20 62 6c 0a 09 74  65 73 74 20 61 6c 2c 30  |nc bl..test al,0|
0000e270  78 30 34 0a 09 6a 6e 7a  20 73 6b 69 70 5f 6c 6f  |x04..jnz skip_lo|
0000e280  6f 70 5f 32 0a 09 63 61  6c 6c 20 49 44 45 5f 44  |op_2..call IDE_D|
0000e290  45 56 49 43 45 5f 44 45  54 45 43 54 45 44 0a 73  |EVICE_DETECTED.s|
0000e2a0  6b 69 70 5f 6c 6f 6f 70  5f 32 3a 0a 09 6d 6f 76  |kip_loop_2:..mov|
0000e2b0  20 61 6c 2c 31 3c 3c 34  0a 09 74 65 73 74 20 62  | al,1<<4..test b|
0000e2c0  6c 2c 32 0a 09 6a 6e 7a  20 49 44 45 5f 53 4d 5f  |l,2..jnz IDE_SM_|
0000e2d0  53 43 41 4e 5f 4c 4f 4f  50 0a 09 0a 49 44 45 5f  |SCAN_LOOP...IDE_|
0000e2e0  44 45 56 49 43 45 5f 4e  4f 54 5f 46 4f 55 4e 44  |DEVICE_NOT_FOUND|
0000e2f0  3a 0a 09 6d 6f 76 20 73  69 2c 6d 73 67 32 0a 09  |:..mov si,msg2..|
0000e300  63 61 6c 6c 20 5f 5f 70  72 69 6e 74 53 74 72 69  |call __printStri|
0000e310  6e 67 78 38 36 0a 09 68  6c 74 0a 09 0a 49 44 45  |ngx86..hlt...IDE|
0000e320  5f 44 45 56 49 43 45 5f  44 45 54 45 43 54 45 44  |_DEVICE_DETECTED|
0000e330  3a 0a 09 0a 70 6f 72 74  5f 74 65 73 74 3a 0a 09  |:...port_test:..|
0000e340  6d 6f 76 20 61 6c 2c 30  78 61 31 0a 09 6d 6f 76  |mov al,0xa1..mov|
0000e350  20 63 6c 2c 35 0a 09 6f  75 74 20 64 78 2c 61 6c  | cl,5..out dx,al|
0000e360  0a 72 65 74 72 79 5f 6c  6f 6f 70 3a 0a 09 0a 77  |.retry_loop:...w|
0000e370  61 69 74 5f 6c 6f 6f 70  3a 0a 09 69 6e 20 61 6c  |ait_loop:..in al|
0000e380  2c 64 78 0a 09 74 65 73  74 20 61 6c 2c 31 3c 3c  |,dx..test al,1<<|
0000e390  37 09 09 3b 77 61 69 74  20 75 6e 74 69 6c 79 20  |7..;wait untily |
0000e3a0  74 68 65 20 64 72 69 76  65 20 69 73 20 6e 6f 74  |the drive is not|
0000e3b0  20 62 75 73 73 79 0a 09  6a 6e 7a 20 77 61 69 74  | bussy..jnz wait|
0000e3c0  5f 6c 6f 6f 70 0a 09 0a  09 74 65 73 74 20 61 6c  |_loop....test al|
0000e3d0  2c 31 09 09 3b 63 68 65  63 6b 20 66 6f 72 20 61  |,1..;check for a|
0000e3e0  6e 20 65 72 72 6f 72 20  69 66 20 69 74 20 65 78  |n error if it ex|
0000e3f0  69 73 74 73 20 72 65 74  72 79 20 69 74 20 61 67  |ists retry it ag|
0000e400  61 69 6e 20 75 70 20 74  6f 20 66 6f 75 72 20 74  |ain up to four t|
0000e410  69 6d 65 73 0a 09 6c 6f  6f 70 6e 7a 20 72 65 74  |imes..loopnz ret|
0000e420  72 79 5f 6c 6f 6f 70 0a  09 6a 7a 20 49 44 45 5f  |ry_loop..jz IDE_|
0000e430  44 45 56 49 43 45 5f 4e  4f 5f 45 52 52 4f 52 0a  |DEVICE_NO_ERROR.|
0000e440  09 72 65 74 0a 49 44 45  5f 44 45 56 49 43 45 5f  |.ret.IDE_DEVICE_|
0000e450  4e 4f 5f 45 52 52 4f 52  3a 0a 09 74 65 73 74 20  |NO_ERROR:..test |
0000e460  61 6c 2c 31 3c 3c 35 0a  09 6a 6e 7a 20 64 72 69  |al,1<<5..jnz dri|
0000e470  76 65 5f 66 61 75 6c 74  09 09 3b 63 68 65 63 6b  |ve_fault..;check|
0000e480  20 66 6f 72 20 61 20 64  72 69 76 65 20 66 61 75  | for a drive fau|
0000e490  6c 74 0a 09 74 65 73 74  20 61 6c 2c 31 3c 3c 33  |lt..test al,1<<3|
0000e4a0  09 09 3b 63 68 65 63 6b  20 69 66 20 64 72 69 76  |..;check if driv|
0000e4b0  65 20 69 73 20 72 65 61  64 79 20 69 66 20 6e 6f  |e is ready if no|
0000e4c0  74 20 72 65 74 72 79 20  69 74 20 61 67 61 69 6e  |t retry it again|
0000e4d0  20 75 70 20 74 6f 20 66  6f 75 72 20 74 69 6d 65  | up to four time|
0000e4e0  73 0a 09 6c 6f 6f 70 7a  20 72 65 74 72 79 5f 6c  |s..loopz retry_l|
0000e4f0  6f 6f 70 0a 09 6a 6e 7a  20 41 54 41 50 49 5f 44  |oop..jnz ATAPI_D|
0000e500  45 56 49 43 45 5f 46 4f  55 4e 44 0a 09 72 65 74  |EVICE_FOUND..ret|
0000e510  0a 09 0a 41 54 41 50 49  5f 44 45 56 49 43 45 5f  |...ATAPI_DEVICE_|
0000e520  46 4f 55 4e 44 3a 09 09  3b 73 74 6f 72 65 73 20  |FOUND:..;stores |
0000e530  74 68 65 20 69 64 65 6e  74 69 66 79 20 70 61 63  |the identify pac|
0000e540  6b 65 74 20 64 65 76 69  63 65 20 64 61 74 61 0a  |ket device data.|
0000e550  09 70 6f 70 20 62 78 0a  09 73 75 62 20 64 78 2c  |.pop bx..sub dx,|
0000e560  37 09 09 3b 73 75 62 73  74 72 61 63 74 20 37 20  |7..;substract 7 |
0000e570  74 6f 20 67 65 74 20 64  61 74 61 20 70 6f 72 74  |to get data port|
0000e580  0a 09 6d 6f 76 20 64 69  2c 49 44 45 4e 54 49 46  |..mov di,IDENTIF|
0000e590  59 5f 50 41 43 4b 45 54  5f 44 45 56 49 43 45 5f  |Y_PACKET_DEVICE_|
0000e5a0  44 41 54 41 0a 09 6d 6f  76 20 63 78 2c 32 35 36  |DATA..mov cx,256|
0000e5b0  0a 09 72 65 70 20 69 6e  73 77 09 09 3b 72 65 63  |..rep insw..;rec|
0000e5c0  69 65 76 65 20 74 68 65  20 35 31 32 20 62 79 74  |ieve the 512 byt|
0000e5d0  65 20 64 61 74 61 0a 09  6d 6f 76 20 61 78 2c 5b  |e data..mov ax,[|
0000e5e0  49 44 45 4e 54 49 46 59  5f 50 41 43 4b 45 54 5f  |IDENTIFY_PACKET_|
0000e5f0  44 45 56 49 43 45 5f 44  41 54 41 5d 0a 09 63 61  |DEVICE_DATA]..ca|
0000e600  6c 6c 20 5f 5f 62 69 6e  61 72 79 54 6f 44 65 63  |ll __binaryToDec|
0000e610  69 6d 61 6c 78 38 36 0a  09 6d 6f 76 20 73 69 2c  |imalx86..mov si,|
0000e620  65 6e 74 65 72 0a 09 63  61 6c 6c 20 5f 5f 70 72  |enter..call __pr|
0000e630  69 6e 74 53 74 72 69 6e  67 78 38 36 0a 09 6d 6f  |intStringx86..mo|
0000e640  76 20 61 78 2c 5b 49 44  45 4e 54 49 46 59 5f 50  |v ax,[IDENTIFY_P|
0000e650  41 43 4b 45 54 5f 44 45  56 49 43 45 5f 44 41 54  |ACKET_DEVICE_DAT|
0000e660  41 2b 38 32 2a 32 5d 0a  09 63 61 6c 6c 20 5f 5f  |A+82*2]..call __|
0000e670  62 69 6e 61 72 79 54 6f  44 65 63 69 6d 61 6c 78  |binaryToDecimalx|
0000e680  38 36 0a 50 41 43 4b 45  54 5f 43 4f 4d 4d 41 4e  |86.PACKET_COMMAN|
0000e690  44 3a 0a 09 78 6f 72 20  61 78 2c 61 78 0a 09 69  |D:..xor ax,ax..i|
0000e6a0  6e 63 20 64 6c 0a 09 6f  75 74 20 64 78 2c 61 6c  |nc dl..out dx,al|
0000e6b0  0a 09 61 64 64 20 64 6c  2c 33 0a 09 6f 75 74 20  |..add dl,3..out |
0000e6c0  64 78 2c 61 6c 0a 09 69  6e 63 20 64 6c 0a 09 6d  |dx,al..inc dl..m|
0000e6d0  6f 76 20 61 6c 2c 32 30  34 38 3e 3e 38 0a 09 6f  |ov al,2048>>8..o|
0000e6e0  75 74 20 64 78 2c 61 6c  0a 09 61 64 64 20 64 6c  |ut dx,al..add dl|
0000e6f0  2c 32 0a 09 6d 6f 76 20  61 6c 2c 30 78 61 30 0a  |,2..mov al,0xa0.|
0000e700  09 6f 75 74 20 64 78 2c  61 6c 0a 09 0a 09 77 61  |.out dx,al....wa|
0000e710  69 74 5f 6c 6f 6f 70 32  3a 0a 09 69 6e 20 61 6c  |it_loop2:..in al|
0000e720  2c 64 78 0a 09 74 65 73  74 20 61 6c 2c 31 3c 3c  |,dx..test al,1<<|
0000e730  37 09 09 3b 77 61 69 74  20 75 6e 74 69 6c 79 20  |7..;wait untily |
0000e740  74 68 65 20 64 72 69 76  65 20 69 73 20 6e 6f 74  |the drive is not|
0000e750  20 62 75 73 73 79 0a 09  6a 6e 7a 20 77 61 69 74  | bussy..jnz wait|
0000e760  5f 6c 6f 6f 70 32 0a 09  0a 09 73 75 62 20 64 6c  |_loop2....sub dl|
0000e770  2c 37 0a 09 6d 6f 76 20  63 6c 2c 36 0a 09 6d 6f  |,7..mov cl,6..mo|
0000e780  76 20 73 69 2c 50 41 43  4b 45 54 31 32 0a 09 72  |v si,PACKET12..r|
0000e790  65 70 20 6f 75 74 73 77  0a 09 6d 6f 76 20 63 68  |ep outsw..mov ch|
0000e7a0  2c 30 78 66 66 0a 09 61  64 64 20 64 6c 2c 37 0a  |,0xff..add dl,7.|
0000e7b0  09 49 44 45 5f 44 52 49  56 45 5f 50 41 43 4b 45  |.IDE_DRIVE_PACKE|
0000e7c0  54 5f 57 41 49 54 5f 4c  4f 4f 50 3a 09 3b 7e 33  |T_WAIT_LOOP:.;~3|
0000e7d0  6d 73 20 64 65 6c 61 79  0a 09 69 6e 20 61 6c 2c  |ms delay..in al,|
0000e7e0  64 78 0a 09 6c 6f 6f 70  20 49 44 45 5f 44 52 49  |dx..loop IDE_DRI|
0000e7f0  56 45 5f 50 41 43 4b 45  54 5f 57 41 49 54 5f 4c  |VE_PACKET_WAIT_L|
0000e800  4f 4f 50 0a 09 73 75 62  20 64 6c 2c 37 0a 09 6d  |OOP..sub dl,7..m|
0000e810  6f 76 20 63 68 2c 31 30  32 34 3e 3e 38 0a 09 6d  |ov ch,1024>>8..m|
0000e820  6f 76 20 64 69 2c 64 61  74 61 5f 74 65 73 74 0a  |ov di,data_test.|
0000e830  09 72 65 70 20 69 6e 73  77 0a 09 0a 09 6d 6f 76  |.rep insw....mov|
0000e840  20 63 78 2c 31 36 0a 09  6d 6f 76 20 62 78 2c 64  | cx,16..mov bx,d|
0000e850  61 74 61 5f 74 65 73 74  0a 09 6d 6f 76 20 73 69  |ata_test..mov si|
0000e860  2c 65 6e 74 65 72 0a 09  0a 09 63 61 6c 6c 20 5f  |,enter....call _|
0000e870  5f 70 72 69 6e 74 53 74  72 69 6e 67 78 38 36 0a  |_printStringx86.|
0000e880  09 6d 6f 76 20 61 78 2c  64 78 0a 09 63 61 6c 6c  |.mov ax,dx..call|
0000e890  20 5f 5f 62 69 6e 61 72  79 54 6f 44 65 63 69 6d  | __binaryToDecim|
0000e8a0  61 6c 78 38 36 0a 09 63  61 6c 6c 20 5f 5f 70 72  |alx86..call __pr|
0000e8b0  69 6e 74 53 74 72 69 6e  67 78 38 36 0a 64 69 73  |intStringx86.dis|
0000e8c0  70 6c 61 79 5f 74 65 73  74 5f 6c 6f 6f 70 3a 0a  |play_test_loop:.|
0000e8d0  09 6d 6f 76 20 65 61 78  2c 5b 62 78 5d 0a 09 61  |.mov eax,[bx]..a|
0000e8e0  64 64 20 62 78 2c 34 0a  09 63 61 6c 6c 20 5f 5f  |dd bx,4..call __|
0000e8f0  62 69 6e 61 72 79 54 6f  44 65 63 69 6d 61 6c 78  |binaryToDecimalx|
0000e900  38 36 0a 09 63 61 6c 6c  20 5f 5f 70 72 69 6e 74  |86..call __print|
0000e910  53 74 72 69 6e 67 78 38  36 0a 09 6c 6f 6f 70 20  |Stringx86..loop |
0000e920  64 69 73 70 6c 61 79 5f  74 65 73 74 5f 6c 6f 6f  |display_test_loo|
0000e930  70 0a 09 68 6c 74 0a 64  72 69 76 65 5f 66 61 75  |p..hlt.drive_fau|
0000e940  6c 74 3a 0a 09 0a 09 68  6c 74 0a 0a 09 25 69 6e  |lt:....hlt...%in|
0000e950  63 6c 75 64 65 20 22 2e  2e 2f 66 75 6e 63 74 69  |clude "../functi|
0000e960  6f 6e 73 2f 5f 5f 70 72  69 6e 74 53 74 72 69 6e  |ons/__printStrin|
0000e970  67 78 38 36 2e 61 73 6d  22 0a 09 25 69 6e 63 6c  |gx86.asm"..%incl|
0000e980  75 64 65 20 22 2e 2e 2f  66 75 6e 63 74 69 6f 6e  |ude "../function|
0000e990  73 2f 5f 5f 62 69 6e 61  72 79 54 6f 44 65 63 69  |s/__binaryToDeci|
0000e9a0  6d 61 6c 78 38 36 2e 61  73 6d 22 0a 09 0a 09 0a  |malx86.asm".....|
0000e9b0  74 69 6d 65 73 20 35 31  30 2d 28 24 2d 24 24 29  |times 510-($-$$)|
0000e9c0  20 64 62 20 30 0a 64 77  20 30 78 61 61 35 35 0a  | db 0.dw 0xaa55.|
0000e9d0  49 44 45 4e 54 49 46 59  5f 50 41 43 4b 45 54 5f  |IDENTIFY_PACKET_|
0000e9e0  44 45 56 49 43 45 5f 44  41 54 41 3a 09 74 69 6d  |DEVICE_DATA:.tim|
0000e9f0  65 73 20 32 35 36 20 64  77 20 30 0a 50 41 43 4b  |es 256 dw 0.PACK|
0000ea00  45 54 31 32 3a 09 64 62  20 30 78 61 38 2c 30 0a  |ET12:.db 0xa8,0.|
0000ea10  09 09 64 62 20 30 2c 30  2c 30 2c 31 36 0a 09 09  |..db 0,0,0,16...|
0000ea20  64 62 20 30 2c 30 2c 30  2c 31 0a 09 09 64 62 20  |db 0,0,0,1...db |
0000ea30  30 2c 30 0a 09 09 0a 50  41 43 4b 45 54 31 36 3a  |0,0....PACKET16:|
0000ea40  0a 6d 73 67 31 3a 20 64  62 20 31 30 2c 22 6f 70  |.msg1: db 10,"op|
0000ea50  65 72 61 74 69 6e 67 20  73 79 73 74 65 6d 20 66  |erating system f|
0000ea60  6f 75 6e 64 22 0a 65 6e  74 65 72 3a 20 64 62 20  |ound".enter: db |
0000ea70  31 33 2c 30 0a 6d 73 67  32 3a 20 64 62 20 22 49  |13,0.msg2: db "I|
0000ea80  44 45 20 64 65 76 69 63  65 20 6e 6f 20 66 6f 75  |DE device no fou|
0000ea90  6e 64 22 2c 31 33 2c 30  0a 64 61 74 61 5f 74 65  |nd",13,0.data_te|
0000eaa0  73 74 3a 09 64 64 09 31  2c 32 2c 33 2c 34 2c 35  |st:.dd.1,2,3,4,5|
0000eab0  2c 36 2c 37 2c 38 2c 39  0a 0a 00 00 00 00 00 00  |,6,7,8,9........|
0000eac0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00010000
